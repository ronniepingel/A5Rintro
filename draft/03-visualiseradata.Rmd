# Visualisering av data
Ett viktigt moment i n??stan alla statistiska analyser ??r att studera data och resultat grafiskt. 

## Dataanalys 1 - Histogram
 
1. ??ppna SPSS.

2. V??lj *File > Open > Syntax*.

3. G?? till mappen Dataanalys1. ??ppna *hyra.sps* och l??s in datafilen *hyra.xlsx*. 

4. Skriv i syntaxfilen
```
GRAPH
 / HISTOGRAM=hyra.
```
**GRAPH** ??r ett huvudkommando som anger att en figur skapas. D??refter f??ljer ett subkommando **/HISTOGRAM** d??r figurtyp samt variabel anges.

5. Spara syntaxfilen, som ska se ut som bilden nedan, med namnet *hyra.sps*. Detta ??r samma namn som f??rut och du kommer efterhand att ut??ka din syntaxfil. 

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/dataanalys1visualisering1.jpg")
```

6. Markera syntaxen som nyss skrevs in och tryck p?? den gr??na knappen *Run Selection*. I *Statistics Viewer* ser du nu din syntax som utf??rts samt ett histogram som skapats.    

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/dataanalys1visualisering2.jpg")
```

7. Du har nu en syntax som du kan anv??nda f??r att l??sa in data och skapa en figur.

8. Du kan spara figuren genom att h??gerklicka p?? den och v??lja *Export...*. D??r v??ljer du i rullisten *Document > None*. Sedan v??ljer du *Graphics > PDF*. Spara filen *histogram1.pdf* i mappen Dataanalys 1

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/dataanalys1visualisering3.jpg")
```

9. ??ppna mappen Dataanalys1 och ??ppna *histogram1.pdf* i en pdf-l??sare. Zooma in och notera att sk??rpan bibeh??lls. P?? grund av detta ??r vektorbaserade format av typen PDF ofta att f??redra framf??r bitmap-baserade filformat (t ex jpg eller jpeg) eftersom det garanterar tillr??ckligt h??g uppl??sning vid utskrift.  








## Dataanalys 1

### Dataanalys 1 - Syntax
I Dataanalys 1 ska du med hälp av kommandon i SPSS läsa in data från en fil som är sparad i Excelformat samt läsa in data som är lagrad i en textfil. 

1. Skapa en mapp på din dator som heter *Dataanalys1*. Skapa under kursens gång en ny mapp för varje ny analys som görs.

2. Ladda ner och spara filen *hyra.xls* i mappen Dataanalys1.

3. Öppna SPSS utan att öppna någon data. I *Data Editor* finns två flikar. Fliken *Variable View* beskriver inlästa variabler. Fliken *Data View* visar inläst data. Bägge flikarna är tomma eftersom inget data ännu är inläst. 

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/spss1.jpg")
```

4. Öpnna *Syntax Editor* genom att välja *File > New > Syntax* i *Data Editor*. I editorn skrivs kommandon som kallas för *syntax*. I syntaxfilen beskrivs exakt den analys av data som ska göras, inklusive alla detaljer och i vilken ordning.


5. Skriv följande syntax i syntaxeditorn. 
```
GET DATA
  /TYPE=XLSX
  /FILE='C:\Users\ronpi764\Dropbox\Teaching\Dataanalyser\Dataanalys1\hyra.xlsx'.
```

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/spss3.jpg")
```

Syntaxen måste vara exakt, inklusive skiljetecken. I syntaxen finns ett huvudkommando som heter **GET DATA**. Detta kommando används för att läsa in datafiler. Därefter används subkommandot **/TYPE** för att ange datafilens format, i detta fall *.xlsx*. Sedan används subkommandot **/FILE** för att ange filens namn inklusive sökväg. Instruktionerna från huvudkommandot avslutas med punkt efter sista subkommandot. 


6. Ändra sökvägen till din sparade *hyra.xls*. Sökvägen får du i Windows 10 fram genom att högerklicka på mappen där din fil finns och sedan välja
"Egenskaper"" (Properties). Sökvägen finns i rutan som kommer upp. 

7. Välj i syntaxeditorn *File > Save as* och spara syntaxfilen som *hyra.sps* i mappen Dataanalys1. Du har nu skrivit och sparat din första syntax-fil!

8. Du ska nu utföra kommandot i syntaxen, dvs du vill läsa in datafilen. Markera all syntax i syntaxeditorn. Tryck därefter på den gröna ''play''-knappen i synatxeditorn. Voila! Nu utför SPSS den markerade syntaxen och läser in data.

9. SPSS ska nu visa tre fönster:
+ *Statistics Viewer* visar syntaxen som utförts. Här presenteras även resultat från analyser. 
+ *Data Editor* visar inläst data. I fliken *Data View* finns 34 rader samt två kolumner med variabelvärden. En variabel heter *hyra* och en heter *kvadratmeter*. Bredvid variabelnamnen finns linjaler. Linjalerna indikerar att
variablerna är numeriska data på intervall/kvotskala. I fliken *Variabel View* finns en utförligare beskrivning av variablerna och hur de presenteras.
+ *Syntax Editor* visar syntaxen och här kan den redigeras ytterligare.

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/spss4.jpg")
```

10. Stäng SPSS. Spara inget. 

*Struktur och noggrannhet är viktigta aspkter vid datanalyser. Detta gäller dels att namn på filer, variabler och funktioner är informativa samt att filer är lättåtkomliga, dels att syntax-filen är välstrukturerad och enkel att begripa.*  

Det är även möjligt att läsa in datafiler via menyn i SPSS. Vi ska ser hur vi kan göra detta samt spara det till syntaxfilen.

### Dataanalys 1 - Meny
 
1. Öppna SPSS.

2. Välj *File > New > Syntax*.

3. Välj *File > Open > Data*. Gå till mappen Dataanalys1. I fliken *Files of type* väljer du *all files*. Du ser då alla filer som du har i mappen. 

4. Välj *hyra.xlsx*. 

5. Tryck OK. Du ska nu få upp följande ruta med alternativ för hur datastrukturen ser ut. 

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/hyra1.jpg")
```

6. Om du trycker på OK kommer data att läsas in. Om du trycker på *Paste* kommer kod för inläsning av data att kopieras till en syntax-fil. Att använda *Paste* är ofta ett bekvämt sätt att använda syntax när man är osäker på hur koden ska se ut. Notera att om du använder *Paste* anger SPSS i syntaxen ofta fler subkommanodn än om något än om koden skrivs in för hand.

7. Tryck OK. Data ska nu vara inläst.

8. Stäng SPSS. Spara inget.



## Dataanalys 2

1. Skapa en mapp som heter Dataanalys2.

2. Ladda ner och spara filen *conscriptdata.csv* i mappen Dataanalys2. Filen har ändelsen *.csv* (*comma-separated values*), vilket står för kommaseparerade värden. Det är ett mycket vanligt textfilsformat för att spara data. 

3. Öppna filen *conscriptdata.csv* i *Anteckningar* (Notepad). Det möjligt att använda *Anteckningar* eftersom datafilen är en textfil. Använd inte Excel! De första raderna i *Anteckningar* ska nu se ut som nedan.
```
"id";"year";"height";"weight";"psych";"muscle";"armstrength";"physical";"gripstrength";"legstrength";"sbp";"dbp";"officer";"testa";"testb";"testc";"testd"
1;1961;171;70;2;3;399,1;5;366,4;446,5;101;73;NA;2;2;5;3
2;1961;171;73;1;3;292,6;5;602,2;321,7;111;58;NA;6;12;5;13
3;1961;157;52;5;3;381,6;2;428,5;400,5;112;72;NA;4;6;14;5
4;1961;165;63;3;4;361;5;532,1;536;118;63;NA;10;7;5;8
5;1961;178;90;3;6;403,3;2;647,4;576,1;121;64;NA;13;10;6;12
```
För data sparade i textformat utgör varje rad ett objekt. Kolumner separeras med separatortecken som kan vara skiljetecken eller avstånd. I filen *conscriptdata.csv* används semikolon för att separera kolumner och kommatecken betecknar decimaltecken. Översta raden utgörs av variabelnamn, där texten för variabelnamnet anges inom citationstecken. Det gäller att veta hur data är strukturerade i textfilen innan data går att läsa in. Exempelvis finns det textfiler där  kolumner separeras med komma, decimaltecknet är punkt och att det saknas en rad för variabelnamn.  

 3. Stäng Anteckningar.
 
 4. Öppna SPSS. 
 
 5. Öpnna *Syntax Editor* genom att välja *File > New > Syntax* i *Data Editor*. Skriv nedanstående syntax i syntaxeditorn. 

```
SET DECIMAL COMMA.

GET DATA  /TYPE=TXT
  /FILE="C:\Users\ronpi764\Dropbox\Teaching\Dataanalyser\Dataanalys2\conscriptiondata.csv"
  /DELIMITERS=";"
  /QUALIFIER='"'
  /FIRSTCASE=2
  /VARIABLES=
  id AUTO
  year AUTO
  height AUTO
  weight AUTO
  psych AUTO
  muscle AUTO
  armstrength AUTO
  physical AUTO
  gripstrength AUTO
  legstrength AUTO
  sbp AUTO
  dbp AUTO
  officer AUTO
  testa AUTO
  testb AUTO
  testc AUTO
  testd AUTO.
```  

```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscript1.jpg")
```

Inläsning av en text-fil kräver att strukturen i datafilen specificeras vid inläsning. I syntaxen anger huvudkommandot **SET DECIMAL COMMA.** att decimalkomma ska användas som decimaltecken. Huvudkommandot **GET DATA** anger precis som tidigare att vi ska läsa in data, sedan följer en rad subkommandon.  Subkommandot **/TYPE=TXT** anger att det är en textfil som ska läsas in, **/DELIMITERS=";"** anger att kolumner separeras med semikolon,  **/QUALIFIER='"'** anger att text i filen måste finnas inom citationstecken, **/FIRSTCASE=2** anger att första objektet finns på rad två eftersom första raden i textfilen utgörs av variabelnamn. Sedan följer efter subkommandot **/VARIABLES** en lista på de variabelnamn som finns i textfilen. Efter varje namn står **AUTO** vilket innebär att SPSS bestämmer datanivån själv. Huvudkommandot **GET DATA** avslutas med en punkt efter det sista **AUTO**.

6. Ändra sökvägen till din sparade *conscriptdata.csv*. Spara sedan syntax-filen *conscription.sps* i mappen Dataanalys2.

7. Läs in data genom att markera all syntax och sedan trycka på ikonen *Run Selection*. Nu kan det ta en liten stund att läsa in data beroende på datorns kapacitet. 

8. Titta i dataeditorn. Det inlästa datamaterialet består av 709869 rader och 17 kolumner. Detta är data för  alla svenska män födda 1961-1975 som mönstrade och några av deras värden vid mönstringen. Notera att det för variabeln officer inte finns en linjal utan tre cirklar vid variabelnamnet. Det innebär att SPSS inte uppfattat variabeln som numerisk utan som ordinal eller nominal. I fliken *Data View* presenteras variablerna och under kolumnen *Type* står att variabeln är *String*. Dessutom står det under *Measure* att variabeln är *Nominal*. Notera att skalnivåerna kan se annorlunda ut på din dator än i bilden här. 
**Betydelsen av datanivåer återkommer vi till senare, men det är oerhört viktigt att variablernas datanivåer är korrekta. En konsekvens kan annars bli felaktiga och oförutsägbara resultat.**


```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscript2.jpg")
```


```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscript3.jpg")
```

9. Du har nu en syntaxfil som du kan använda för att läsa in *conscriptdata.csv*.

10. Stäng SPSS. Spara inget.

### Datanalys 2 - Meny


1. Öppna SPSS.

2. Välj *File > New > Syntax*.

3. Välj *File > Open > Data*. Gå till mappen Dataanalys2. I fliken *Files of type* väljer du *all files*. Du ser då alla filer som du har i mappen. 

4. Välj *conscriptdata.csv*. 

5. Tryck OK. 

6. Du ska nu få upp följande ruta med alternativ för hur datastrukturen ser ut. Tryck next.
```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscriptreadmenu1.jpg")
```

7. Välj *Delimited* eftersom du vet att variabler separeras med semikolon. Välj *Yes* till frågan om variabler återfinns på i början i textfilen. Välj *Comma* eftersom decimaltecknet i textfilen är komma. Tryck next.
```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscriptreadmenu2.jpg")
```

8. Välj att observationerna börjar på rad 2. Välj att varje rad representerar en observation. Välj att du vill importera alla observationer.  Tryck next.
```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscriptreadmenu3.jpg")
```

9. Välj att semicolon som delimiter. Tryck next.
```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscriptreadmenu4.jpg")
```

10. Nu ska du välja variablerna dataformat. Default är automatic och vi trycker next utan att ändra något.
```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscriptreadmenu5.jpg")
```

10. Detta är sista steget. Tryck *Finish*. Notera att du kan välja *Would like to paste the syntax* vilket innebär att kommandona som används för att läsa in datafilen kopieras till en syntaxfil.
```{r, echo = FALSE, out.width = "80%", dpi = 72}
knitr::include_graphics("images/conscriptreadmenu6.jpg")
```

11. Kontrollera så att filen är inläst. Ibland misslyckas SPSS med avgöra rätt datatyp. Just nu är detta inget problem.

12. Stäng SPSS. Spara inget.






