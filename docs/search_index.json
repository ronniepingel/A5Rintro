[
["tabeller.html", "Kapitel 8 Tabeller 8.1 Frekvenstabeller 8.2 Korstabeller 8.3 Exportera tabeller till html 8.4 Frekvent förekommande tabeller 8.5 Statistisk inferens baserat på korstabeller", " Kapitel 8 Tabeller Att presentera resultat och samband med diskreta variabler och kategorivariabler är en viktig del av att arbeta med Frekvenstabeller i R, med och utan paket Korstabeller i R, med och utan paket Export av tabeller till Word. 8.1 Frekvenstabeller 8.1.1 Frekvenstabeller med table() # Läs in data. Välj ut födda 1961 och födda 1975 insark &lt;- read.csv2(&quot;D:/conscriptiondata.csv&quot;) # Välja ut insark för födda 1961 insark1 &lt;- insark[insark$year == 1961,] # Välj ut INSARK för födda 1975 insark2 &lt;- insark[insark$year == 1975,] # Skapa ett dataset av INSARK 1961 och 1975. insark3 &lt;- rbind(insark1, insark2) # Skapa nytt radid baserat på delpopulationen 1961 och 1975 insark3$newid &lt;- 1:length(insark3$id) Vi ska nu dra ett urval från INSARK. Anledningen till detta är enbart pedagogiskt, dvs vi får ett datamaterial som översiktlig. I praktiken används den data som tillgänglig! Beträffade funktionen set.seed() så används denna för att ange vilket slumpmässigt urval som dras. Annars erhålls inte samma skattningar som i exemplet. I praktiken vid urvalsdragning används inte set.seed() n &lt;- 1000 set.seed(12345) df &lt;- insark3[sample(insark3$newid, n), ] Baserat på urvalet är nu målet att skapa frekvenstabell som innehåller både absoluta och relativa frekvenser. För att skapa tabeller används funktionerna table() och hantera både tabuleringar av en enda variabler eller korstabeller av två eller flera variabler. Notera att table() enbart presenterar frekvenser för att få utförligare resultat krävs att tabellen sparas som ett objekt, på vilket andra funktioner kan användas. prop.table() tillämpad på ett objekt från table() och beräknar proportioner baserat på totala antalet (default), radvisa frekvenser eller kolumnfrekvenser. addmargins() ger marginalerna i ett tabellobjeket. Med argumentet margins anges om alla marginaler, radmarginalen eller kolumnmargialen ska beräknas. Baserat på urvalet är nu målet är att skapa en tabell som beskriver variabeln psych, som är bedömd psykisk funktionsförmåga som är en variabel med 9 steg, där 1 är sämst och 9 är bäst. Vi börjar med att titta på exemplet där variabeln psych används som numerisk variabel. Med funktionerna colnames() och rownames() går det att namnge kolumner och rader i tabellobjektet. # Univariat tabell med frekvenser och proportioner freqtable_psych &lt;- table(df$psych) proptable_psych &lt;- prop.table(freqtable_psych) table_psych &lt;- cbind(freqtable_psych, 100*proptable_psych) table_psych &lt;- addmargins(table_psych, margin = 1) colnames(table_psych) &lt;- c(&quot;Frekvens&quot;, &quot;%&quot;) rownames(table_psych) &lt;- c(&quot;Kat 1&quot;, &quot;Kat 2&quot;, &quot;Kat 3&quot;, &quot;Kat 4&quot;, &quot;Kat 5&quot;, &quot;Kat 6&quot;, &quot;Kat 7&quot;, &quot;Kat 8&quot;, &quot;Kat 9&quot;, &quot;Total&quot;) freqtable_psych &gt; &gt; 1 2 3 4 5 6 7 8 9 &gt; 19 67 122 150 220 200 145 65 12 proptable_psych &gt; &gt; 1 2 3 4 5 6 7 8 9 &gt; 0.019 0.067 0.122 0.150 0.220 0.200 0.145 0.065 0.012 table_psych &gt; Frekvens % &gt; Kat 1 19 1.9 &gt; Kat 2 67 6.7 &gt; Kat 3 122 12.2 &gt; Kat 4 150 15.0 &gt; Kat 5 220 22.0 &gt; Kat 6 200 20.0 &gt; Kat 7 145 14.5 &gt; Kat 8 65 6.5 &gt; Kat 9 12 1.2 &gt; Total 1000 100.0 Notera att tabellen med proportioner multipliceras med 100 för att få resultaten i procent. Det kan även finns anledning att avrunda resultat med funktionen round(). Antalet decimaler i avrundningen beror på behovet av precision i resultatredovisningen. Ska tabellen användas i beräkningar i R, alltså inte som en del av en rapport, bör ingen dock avrundning ske. table_psych &lt;- cbind(round(freqtable_psych, 0), round(100*proptable_psych), 0) Alternativet är nu att skapa en variabel som heter psych_cat och sedan använda funktionen levels() för att ange nivåerna i faktorn. Som vanligt när vi skapar en ny variabel adderas vi den till datamaterialet. # För att namnge raderna kan göra om psych-variabeln till en faktor som namnges. df$psych_cat &lt;- factor(df$psych, ordered = TRUE) levels(df$psych_cat) = c(&quot;Kat 1&quot;, &quot;Kat 2&quot;, &quot;Kat 3&quot;, &quot;Kat 4&quot;, &quot;Kat 5&quot;, &quot;Kat 6&quot;, &quot;Kat 7&quot;, &quot;Kat 8&quot;, &quot;Kat 9&quot;) freqtable_psych_cat &lt;- table(df$psych_cat) proptable_psych_cat &lt;- prop.table(freqtable_psych_cat) table_psych_cat &lt;- cbind(round(freqtable_psych_cat), round(100*proptable_psych_cat, 1)) table_psych_cat &lt;- addmargins(table_psych_cat, 1) colnames(table_psych_cat) &lt;- c(&quot;Frekvens&quot;, &quot;%&quot;) table_psych_cat &gt; Frekvens % &gt; Kat 1 19 1.9 &gt; Kat 2 67 6.7 &gt; Kat 3 122 12.2 &gt; Kat 4 150 15.0 &gt; Kat 5 220 22.0 &gt; Kat 6 200 20.0 &gt; Kat 7 145 14.5 &gt; Kat 8 65 6.5 &gt; Kat 9 12 1.2 &gt; Sum 1000 100.0 Du har nu konstruerat en frekvenstabell utifrån bägge tillvägagångsätten. Det är viktigt vid alla dataanlyser är att veta hur funktionerna som används hanterar saknade data. Default-inställningen för table() är att ignorera sådana observationer. För att redovisa saknade data som en egen kategori används argumentet useNA = &quot;ifany&quot;. # Skapa en bortfallsvariabel på position 3 och 4 i variabeln psych df$psych_mis &lt;- df$psych df$psych_mis[c(3,4)] &lt;- NA table_psych_mis &lt;- table(df$psych_mis, useNA = &quot;ifany&quot;) table_psych_mis &gt; &gt; 1 2 3 4 5 6 7 8 9 &lt;NA&gt; &gt; 19 67 121 150 219 200 145 65 12 2 8.1.2 Frekvenstabeller med freq() Även om table() är väldigt flexibelt och användbart finns det också färdiga funktioner som kan förenkla koden. Ett smidigt R-paket för beskriva och summera data är **summarytools*. Skriv därför install.packages(&quot;summarytools&quot;). På MacOS krävs eventuellt även av ett program som heter XQuartz, som görs externt från https://www.xquartz.org/releases/index.html. När programmet är installerat kan följande kod användas för att enkelt skapa en frekvenstabell. Funktionen freq() används för att skapa en frekvens och för att replikera tabellerna ovan används följande kod. library(&quot;summarytools&quot;) tab_psych &lt;- freq(df$psych, report.nas = FALSE, cumul = FALSE) tab_psych_cat &lt;- freq(df$psych_cat, report.nas = FALSE, cumul = FALSE) tab_psych_mis &lt;- freq(df$psych_cat, report.nas = TRUE, cumul = FALSE) tab_psych &gt; Frequencies &gt; df$psych &gt; &gt; Freq % &gt; ----------- ------ -------- &gt; 1 19 1.90 &gt; 2 67 6.70 &gt; 3 122 12.20 &gt; 4 150 15.00 &gt; 5 220 22.00 &gt; 6 200 20.00 &gt; 7 145 14.50 &gt; 8 65 6.50 &gt; 9 12 1.20 &gt; Total 1000 100.00 tab_psych_cat &gt; Frequencies &gt; df$psych_cat &gt; Type: Ordered Factor &gt; &gt; Freq % &gt; ----------- ------ -------- &gt; Kat 1 19 1.90 &gt; Kat 2 67 6.70 &gt; Kat 3 122 12.20 &gt; Kat 4 150 15.00 &gt; Kat 5 220 22.00 &gt; Kat 6 200 20.00 &gt; Kat 7 145 14.50 &gt; Kat 8 65 6.50 &gt; Kat 9 12 1.20 &gt; Total 1000 100.00 tab_psych_mis &gt; Frequencies &gt; df$psych_cat &gt; Type: Ordered Factor &gt; &gt; Freq % Valid % Total &gt; ----------- ------ --------- --------- &gt; Kat 1 19 1.90 1.90 &gt; Kat 2 67 6.70 6.70 &gt; Kat 3 122 12.20 12.20 &gt; Kat 4 150 15.00 15.00 &gt; Kat 5 220 22.00 22.00 &gt; Kat 6 200 20.00 20.00 &gt; Kat 7 145 14.50 14.50 &gt; Kat 8 65 6.50 6.50 &gt; Kat 9 12 1.20 1.20 &gt; &lt;NA&gt; 0 0.00 &gt; Total 1000 100.00 100.00 Notera att vid användning av funktionen freq() är det en fördel att använda faktorn psych_cat eftersom kategorierna är namngivna. Det går inte här i efterhand att namnge kategorierna i våra variabler. Här har vi således ett exempel när faktorn är att föredra framför den numeriska variabeln. Vi kommer senare att stöta på det motsatta. Som vanligt har funktioner i R fleravargument som anger exakt vad funktionen ska göra. I exemplen redogörs bara för ett fåtal av dessa och ofta krävs att det att man använder sig av hälpfilen för en funktion, i detta fall help(freq), eller att man provar ändra i den kod som finns. 8.2 Korstabeller 8.2.1 Korstabeller med table() Flera variabler kan korstabuleras i table(). Variabeln som ska finnas på raden kommer före variabeln som på kolumnen. Tabellen som erhålls kallas i fallet med två inkluderade variabler för tvåvägs-korstabell. Om det går att översätta variablerna i termer av förklarande variabel och beroende variabel, sätts den förklarande variabeln i regel kolumnsvis. Det kan dock av utrymmesskäl finnas anledning att rucka på denna princip. Vi ska nu beskriva psyskologisk bedömning uppdelat på födda 1961 respektive 1975. Först en korstabell med frekvenser och baserat på denna skapa en korstabell med relativa frekvenser baserat på kolumnprocent. Notera att det kräver en del pusslande, men vi har stor flexibilitet vad gäller att konstruera tabellen. freqtable_psych_year &lt;- table(df$psych, df$year) freqtable_psych_year 1961 1975 1 10 9 2 29 38 3 64 58 4 78 72 5 112 108 6 91 109 7 55 90 8 27 38 9 6 6 proptable_psych_year &lt;- 100*prop.table(freqtable_psych_year, margin = 2 ) # 2 är kolumnprocent # Bind ihop frekvenser och relative frekvenser table_psych_year_bind &lt;- cbind(freqtable_psych_year[,1], round(proptable_psych_year[,1], 1), freqtable_psych_year[,2], round(proptable_psych_year[,2], 1)) table_psych_year &lt;- addmargins(table_psych_year_bind, 1) colnames(table_psych_year) &lt;- c(&quot;1961&quot;, &quot;%&quot;, &quot;1975&quot;, &quot;%&quot;) rownames(table_psych_year) &lt;- c(&quot;Kat 1&quot;, &quot;Kat 2&quot;, &quot;Kat 3&quot;, &quot;Kat 4&quot;, &quot;Kat 5&quot;, &quot;Kat 6&quot;, &quot;Kat 7&quot;, &quot;Kat 8&quot;, &quot;Kat 9&quot;, &quot;Total&quot;) table_psych_year 1961 % 1975 % Kat 1 10 2.1 9 1.7 Kat 2 29 6.1 38 7.2 Kat 3 64 13.6 58 11.0 Kat 4 78 16.5 72 13.6 Kat 5 112 23.7 108 20.5 Kat 6 91 19.3 109 20.6 Kat 7 55 11.7 90 17.0 Kat 8 27 5.7 38 7.2 Kat 9 6 1.3 6 1.1 Total 472 100.0 528 99.9 Alternativt kan vi använda funktionen ctable() från paketet summarytoools. df$year_cat &lt;- factor(df$year) tab_psych_year &lt;- ctable(df$psych_cat, df$year_cat, prop = &quot;c&quot;) tab_psych_year Cross-Tabulation, Column Proportions psych_cat * year_cat Data Frame: df ----------- ---------- -------------- -------------- --------------- year_cat 1961 1975 Total psych_cat Kat 1 10 ( 2.1%) 9 ( 1.7%) 19 ( 1.9%) Kat 2 29 ( 6.1%) 38 ( 7.2%) 67 ( 6.7%) Kat 3 64 ( 13.6%) 58 ( 11.0%) 122 ( 12.2%) Kat 4 78 ( 16.5%) 72 ( 13.6%) 150 ( 15.0%) Kat 5 112 ( 23.7%) 108 ( 20.5%) 220 ( 22.0%) Kat 6 91 ( 19.3%) 109 ( 20.6%) 200 ( 20.0%) Kat 7 55 ( 11.7%) 90 ( 17.0%) 145 ( 14.5%) Kat 8 27 ( 5.7%) 38 ( 7.2%) 65 ( 6.5%) Kat 9 6 ( 1.3%) 6 ( 1.1%) 12 ( 1.2%) Total 472 (100.0%) 528 (100.0%) 1000 (100.0%) ----------- ---------- -------------- -------------- --------------- 8.3 Exportera tabeller till html Det kan vara omständligt att exportera data från R till Word. En smidigt lösning är att spara tabellerna i html-format, vilket gör tabellerna plattformsoberoende. Kom ihåg att det inte är nödvändigt att lägga in tabellerna i Word förrän manuset närmar sig att bli klart. För att exporteravv tabeller gjorda med table() används paketet xtable och funktionen xtable() tillsammans med funktionen print() (som finns i basversionen av R). Installera därför nödvändigt paket install.packages(&quot;xtable&quot;) och kör sedan nedanstående kod. Du måste ange i sökvägen var filen ska sparas. library(&quot;xtable&quot;) print(xtable(table_psych_cat), type=&quot;html&quot;, file=&quot;table_psych_cat.html&quot;) print(xtable(table_psych_year), type=&quot;html&quot;, file=&quot;table_psych_year.html&quot;) För exportera tabeller gjorda i summarytools kan vi använda funktionen print() direkt. print(tab_psych_cat, headings = FALSE, file=&quot;tab_psych_cat.html&quot;) print(tab_psych_year, headings = FALSE, file=&quot;D:/tab_psych_year.html&quot;) För att sedan föra in tabellerna i ordbehandlingsprogram öppnas tabellen i en webläsare, du högerklickar någonstans i webläsaren och väljer markera allt, kopiera, och klistra in. 8.4 Frekvent förekommande tabeller 8.4.1 Tabell för att beskriva urvalet Alla rapporter eller vetenskapliga artiklar bör inkludera en beskrivning av urvalet, dvs variablerna fördelning i stickprovet. Frågan som då besvaras är ‘’Vilka är det vi vi undersöker?’’. Ibland är denna beskrivning placeread i början, ibland i en bilaga. Inom en del vetenskapliga artiklar benämns en sådan tabell Tabell 1 eller Table 1. Observera att eftersom syftet inte är att göra inferens utan enbart att beskriva urval, dvs normallt sett redovisas inte medelfel, konfidensintervall eller \\(p\\)-värden. För att skapa en sådan tabell är det enklast att i R skapa en tabell separat för kvantitativa variabler som redovisas medelvärde, standardavvikelse och evenuellt andra mått och en för Därefter kan man kombinera tabellerna i Word. # I studien krävs en variabel som indikerar högt blodtryck. # För varje blodtrycksvariabel skapas 2 nya varibler till vårt dataset: # 1. en binär 0-1 variabel som är numerisk # 2. en binär variabel som R hanterar som en faktor med namngivna nivåer. # Att ändra namn på faktorers nivåer är lite omständligt, men det är enkelt att använda nedanstående kod. df$sbp_bin &lt;- NA df$sbp_bin[df$sbp &gt;= 130] &lt;- 1 df$sbp_bin[df$sbp &lt; 130] &lt;- 0 df$sbp_cat &lt;- factor(df$sbp_bin) levels(df$sbp_cat)[levels(df$sbp_cat) == &quot;0&quot;] &lt;- &quot;Normalt&quot; levels(df$sbp_cat)[levels(df$sbp_cat) == &quot;1&quot;] &lt;- &quot;Högt&quot; df$dbp_bin &lt;- NA df$dbp_bin[df$dbp &gt;= 80] &lt;- 1 df$dbp_bin[df$dbp &lt; 80] &lt;- 0 df$dbp_cat &lt;- factor(df$dbp_bin) levels(df$dbp_cat)[levels(df$dbp_cat) == &quot;0&quot;] &lt;- &quot;Normalt&quot; levels(df$dbp_cat)[levels(df$dbp_cat) == &quot;1&quot;] &lt;- &quot;Högt&quot; # Skapa Tabell 1a. Kvantitativa variabler xbar_height &lt;- mean(df$height) sd_height &lt;- sd(df$height) xbar_weight &lt;- mean(df$weight) sd_weight &lt;- sd(df$weight) xbar_sbp &lt;- mean(df$sbp) sd_sbp&lt;- sd(df$sbp) xbar_dbp &lt;- mean(df$dbp) sd_dbp&lt;- sd(df$dbp) means &lt;- round(c(xbar_height, xbar_weight, xbar_sbp, xbar_dbp ), 1) sds &lt;- round(c(sd_height, sd_weight, sd_sbp, sd_dbp), 2) table1_cont_vars &lt;- cbind(means, sds) colnames(table1_cont_vars) &lt;- c(&quot;Medelvärde&quot;, &quot;SD&quot;) rownames(table1_cont_vars) &lt;- c(&quot;Längd (cm)&quot;, &quot;Vikt (kg)&quot;, &quot;Systoliskt blodtryck (mmHg)&quot;, &quot;Diastoliskt blodtryck (mmHg)&quot;) # Skapa Tabell 1b. Kategorivariabler desc_sbp_bin &lt;- cbind(table(df$sbp_bin), 100*prop.table(table(df$sbp_bin))) desc_dbp_bin &lt;- cbind(table(df$dbp_bin), 100*prop.table(table(df$dbp_bin))) desc_psych_cat &lt;- cbind(table(df$psych), 100*prop.table(table(df$psych))) table1_cat_vars &lt;- rbind(desc_sbp_bin, desc_dbp_bin, desc_psych_cat) colnames(table1_cat_vars) &lt;- c(&quot;Antal&quot;, &quot;%&quot;) rownames(table1_cat_vars) &lt;- c(&quot;Systoliskt blodtryck (mmHG &lt; 130)&quot;, &quot;Systoliskt blodtryck (mmHG &gt;= 130)&quot;, &quot;Diastoliskt blodtryck (mmHG &lt; 80)&quot;, &quot;Diastoliskt blodtryck (mmHG &gt;= 80)&quot;, &quot;Psykologisk bedömning: Kat 1&quot;, &quot;Psykologisk bedömning: Kat 2&quot;, &quot;Psykologisk bedömning: Kat 3&quot;, &quot;Psykologisk bedömning: Kat 4&quot;, &quot;Psykologisk bedömning: Kat 5&quot;, &quot;Psykologisk bedömning: Kat 6&quot;, &quot;Psykologisk bedömning: Kat 7&quot;, &quot;Psykologisk bedömning: Kat 8&quot;, &quot;Psykologisk bedömning: Kat 9&quot;) I R ser tabellerna ut som följer. table1_cont_vars Medelvärde SD Längd (cm) 179.3 6.58 Vikt (kg) 70.5 10.68 Systoliskt blodtryck (mmHg) 128.6 10.98 Diastoliskt blodtryck (mmHg) 66.9 9.83 table1_cat_vars Antal % Systoliskt blodtryck (mmHG &lt; 130) 519 51.9 Systoliskt blodtryck (mmHG &gt;= 130) 481 48.1 Diastoliskt blodtryck (mmHG &lt; 80) 900 90.0 Diastoliskt blodtryck (mmHG &gt;= 80) 100 10.0 Psykologisk bedömning: Kat 1 19 1.9 Psykologisk bedömning: Kat 2 67 6.7 Psykologisk bedömning: Kat 3 122 12.2 Psykologisk bedömning: Kat 4 150 15.0 Psykologisk bedömning: Kat 5 220 22.0 Psykologisk bedömning: Kat 6 200 20.0 Psykologisk bedömning: Kat 7 145 14.5 Psykologisk bedömning: Kat 8 65 6.5 Psykologisk bedömning: Kat 9 12 1.2 För exportera använder du som förut paketet xtable. Kör library(&quot;xtable&quot;) om det inte är aktiverat. print(xtable(table1_cont_vars, digits = 1), type=&quot;html&quot;, file=&quot;D:/table1_cont_vars.html&quot;) print(xtable(table1_cat_vars, digits = c(0,0,1)), type=&quot;html&quot;, file=&quot;D:/table1_cat_vars.html&quot;) En tabell skulle kunna se ut som följer, där bägge tabellerna för kvantitativa variabler och kategorivariabler är i Word sammanfogade till en tabell. Ett enklare sätt att skapa en tabell som redovisar grundläggande statistik som går att exportera är med paketet table. Installera paketet install.packages(&quot;table1&quot;). Detta förenklar betydligt, men variabler och nivåer kan inte namnges i efterhand. Det finns det två sätt att konstruera tabellen namnge alla variabler och kategorier i ditt data frame library(&quot;table1&quot;) label(df$height) &lt;- &quot;Längd (cm)&quot; label(df$weight) &lt;- &quot;Vikt (kg)&quot; label(df$sbp) &lt;- &quot;Systoliskt blodtryck (mmHg)&quot; label(df$dbp) &lt;- &quot;Diastroliskt blodtryck (mmHg)&quot; label(df$sbp_cat) &lt;- &quot;Högt systoliskt blodtryck&quot; label(df$dbp_cat) &lt;- &quot;Högt diastoliskt blodtryck&quot; label(df$psych_cat) &lt;- &quot;Psykologisk bedömning&quot; tab1 &lt;- table1(~ height + weight + sbp + dbp + sbp_cat + dbp_cat + psych_cat, data=df) tab1 Overall(n=1000) Längd (cm) Mean (SD) 179 (6.58) Median [Min, Max] 179 [159, 198] Vikt (kg) Mean (SD) 70.5 (10.7) Median [Min, Max] 70.0 [46.0, 136] Systoliskt blodtryck (mmHg) Mean (SD) 129 (11.0) Median [Min, Max] 129 [61.0, 160] Diastroliskt blodtryck (mmHg) Mean (SD) 66.9 (9.83) Median [Min, Max] 67.5 [39.0, 99.0] Högt systoliskt blodtryck Normalt 519 (51.9%) Högt 481 (48.1%) Högt diastoliskt blodtryck Normalt 900 (90.0%) Högt 100 (10.0%) Psykologisk bedömning Kat 1 19 (1.9%) Kat 2 67 (6.7%) Kat 3 122 (12.2%) Kat 4 150 (15.0%) Kat 5 220 (22.0%) Kat 6 200 (20.0%) Kat 7 145 (14.5%) Kat 8 65 (6.5%) Kat 9 12 (1.2%) Höger klicka på tabellen och kopiera eller spara den som html. Kopiera och klistra in i Word. 8.5 Statistisk inferens baserat på korstabeller Det vanligaste testet för analys av korstabeller är \\(\\chi^2\\)-test som testar om två variabler är oberoende. För att genomföra detta test i R används funktionen chisq.test(). Detta test går att genomföra oavsett skalnivå, men det finns alternativ med bättre styrka om avsikten är att testa om det finns en trend och det faktiskt finns en sådan. chisq.test(df$psych_cat, df$year) Pearson&#39;s Chi-squared test data: df$psych_cat and df$year X-squared = 10.697, df = 8, p-value = 0.2195 Om bägge variablerna på ordinalskala med tillräckligt många skalsteg kan man använda test av Spearmans rangkorrelation. "]
]
